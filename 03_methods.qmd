# Methodology

```{R setup, file = "R/chapter_start.R", include = FALSE, cache = FALSE}

```

## Data

In this research, we explored a unique dataset of young adults who have expressed suicide ideation in professional therapy contexts. This study was conducted by the Brigham Young University’s Counseling and Psychology Services (CAPS). The study included 88 young adults residing in Utah County. @tbl-descriptivestats provides a description of the participants' age and IQ descriptive statistics. The average participant was 23.8 years old and the average IQ score was 120.8.

@tbl-descriptivestats also provides a description of the participants' sex, group, and race. There were 65 individuals assigned female at birth and 23 individuals assigned male at birth. While gender of each participant was also recorded, the sex assigned at birth is used for this analysis. Each participant belonged to one of four groups based on a psychological evaluation: social anxiety, autism, control, or no group. Those who were part of the no group initially thought that they were part of the social anxiety group or the autism group, but after the physiological evaluation, it was found that they were not part of those groups. These individuals were grouped together with the control group for this analysis. Of the 88 participants in the study, 28 belong to the social anxiety group, 29 belong to the autism group, and the remaining 31 are part of the control group. The majority of participants were White, but Hispanic or Latino and Asian participants were also part of the study.

```{r table descripstats, message=FALSE, echo=FALSE}
#| label: tbl-descriptivestats
#| tbl-cap: "Descriptive statitics: age, IQ, sex, group, and race."

tar_load(descrip_stats)

datasummary_balance(~1, descrip_stats)
```

Participants installed an application on their phone that collected cellular location-based services (LBS) data. The participants participated to varying degrees with some providing 1 month of LBS data and others providing up to 1 year of data. There was a period of time \[1 MONTH\] when no LBS data was collected by the application. In addition to collecting LBS data, the application prompted participants to complete a survey answering questions about their mental health. Surveys were administered in the mornings and the evenings and asked questions such as “Have you felt stressed since you last took a survey?”, “How would you rate your overall sleep quality last night?”, and “Have you thought about killing yourself in the past 12 hours or since you last took a survey?” among others. Participants were monetarily incentivized to complete the mental health surveys. 

By integrating LBS data and mental health survey responses, this dataset enables the analysis of the impact of individual travel behavior on mental well-being, with a particular focus on understanding the interaction between travel behavior and individuals from neurodiverse groups. Additionally, it allows for investigating how characteristics of neurodiverse groups influence travel behavior. The data is cleaned and processed so this analysis can be performed.

## Cleaning the Data

The first step is to clean the raw LBS data so the data can be distilled into semantic activities and locations using the DBSCAN-TE algorithm which will be described further on [@macfarlaneClassifyingLocationPoints2024]. The raw LBS data includes the ID associated with each participant, the time stamp consisting of the date and time when the data was collected, and the geometry, meaning latitude and longitude, of each data point. 

When analyzing data points for each day, instead of defining a single day of activities from midnight to midnight, the data underwent additional cleaning to shift the 24-hour period from 3AM to 3AM. This adjustment ensured that any timestamp recorded between midnight and 3AM was attributed to the preceding calendar date, indicating it as the the final data points of the preceding day rather than the initial data points of the following day. The data points encompassed in the 3AM to 3AM 24-hour period make up the activity day, which is associated with the preceding day. The evening mental health survey closed at 3AM each day, so a survey taken between midnight and 3AM would be the evening survey and would be associated with the activity day as previously described. 

From there, the LBS data was grouped by participant ID, activity day, and hour and a scoring algorithm was implemented to assess the quality and completeness of GPS data for each combination of user IDs and activity days. This algorithm identifies userID-activity days that exhibit a high score, indicating a sufficient quantity and distribution of LBS points within the designated time frame. The scoring mechanism is based on two factors: the hour of the day and the number of LBS points recorded. For hours from 8AM to 11PM, which are hours where the likelihood of significant activity is greater, a score of 3 is assigned to the hour and for hours not between 8AM and 11PM, a score of 1 is assigned to the hour. The other aspect adjusts the score based on the number of LBS points recorded within the hour. The algorithm categorizes the number of LBS points into different tiers and assigns a score multiplier corresponding to each tier. The tiers are described as follows: for an hour with less than 500 points, a score of 0 is assigned; for an hour with between 500 and 1500 points, a score of 1 is assigned; for an hour with between 1500 and 2500 points, a score of 2 is assigned; and for an hour with more than 2500 points, a score of 3 is assigned. To determine the final score the score based on the hour of the day and the score based on the number of LBS points are multiplied and then summed to determine the daily score. By summing the scores for the day and selecting high scoring days, the algorithm provides a comprehensive assessment of the quality of LBS points collected on a given day for each user and activity day. A “high scoring” day was determined to be one that had a final score of 95 or greater. This threshold was chosen as a cutoff to retain only those userID-activity day pairs with a relatively high quality LBS dataset. This threshold ensures that only data deemed to be sufficiently complete and accurate is retained for further analysis for determining the trip patterns for participants during the day. 

-   \[SHOW WHAT A HIGH SCORING DAY LOOKS LIKE AND WHAT A LOW SCORING DAY LOOKS LIKE\] 

-   \[TALK ABOUT HOW MANY USERID-ACTIVITYDAY COMBOS THERE WERE BEFORE APPLYING THE ALGORITHM AND HOW MANY THERE ARE LEFT AFTER\]

The data collection application recorded LBS data every second that the participants' cell phone was on. To improve workability of the data, a random sample of 6 LBS points per minute was extracted for each high scoring userId-activity day. If the total number of LBS data points for a day was less than 1000, then that day was removed. The data points were then converted into latitude and longitude coordinates to visualize them on a map.

-   Look into whether any activityDays were lost by filtering to 1000 points (this step might be unnecessary)

## Processing the Trips

The DBSCAN-TE algorithm was used to determine where activities occurred during the day and how many activities were engaged in during the day. This algorithm is a density-based clustering non-parametric algorithm where given a set of points in some space, it groups together points that are closely packed together. DBSCAN stands for density-based spatial clustering of applications with noise and the TE add an entropy constraint and temporal sequence constraint which allows for better classification of activities during one’s day. The parameters for the DBSCAN-TE algorithm were previously optimized and were implemented on the LBS data set [@macfarlaneClassifyingLocationPoints2024].

The optimized values for the parameters parameters were implemented and the number of activities were determined for the high scoring userId-activity days. Then it was determined which activities during a given activity day occurred at parks, grocery stores, libraries, and social-recreation locations. After processing the data, we ended up with 3,845 userId-activityDays that had sufficient enough data to create good trip data.

@fig-numAct shows the distribution of the number of activities on a given day for those 3,845 days.

```{r figure numAct, message=FALSE, echo=FALSE}
#| label: fig-numAct
#| fig-cap: "Distribution of activities per day for all userId-activityDays."

tar_load(final_table)

raw_trips <- final_table %>% 
    filter(!is.na(numTrips))
  
ggplot(raw_trips, aes(x = numTrips)) +
    geom_histogram(binwidth = 1, fill = "darkgray", color = "black") +
    labs(x = "Number of Activities", y = "Frequency") +
    theme_bw()
```

After identifying high-scoring userId-activity days using this scoring algorithm and using the DBSCAN-TE algorithm to determine the number of activities per day, an imputation process was conducted to enhance the dataset's completeness. This imputation aimed to fill in missing trip data for certain days, either due to the absence of data collection or the poor quality of data, ensuring a more comprehensive dataset aligning with the days of mental health survey responses. The imputation used rolling averages to estimate the number of trips for specific time frame and activity types. This process involved calculating averages over varying time windows, such as seven, fourteen, and thirty days, to capture trends and patterns in trip data. The imputation process was applied separately for different activity types, including park visits, grocery shopping, and library visits, to account for potential variations in activity patterns across different contexts.

After using the rolling averages, there were 5,673 userId-activityDays for the seven day rolling average, 6,252 userId-activityDays for the fourteen day rolling average, and 7,130 userId-activityDays for the thirty day rolling average.

@fig-numActsev show the distribution of activities for the seven day rolling average.

```{r figure numAct_sev, message=FALSE, echo=FALSE}
#| label: fig-numActsev
#| fig-cap: "Distribution of 7-day rolling average number of activities per day for all userId-activityDays."

tar_load(final_table)

raw_trips <- final_table %>% 
    filter(!is.na(sev_day_avg))
  
ggplot(raw_trips, aes(x = sev_day_avg)) +
    geom_histogram(binwidth = 1, fill = "darkgray", color = "black") +
    labs(x = "Number of Activities", y = "Frequency") +
    theme_bw()
```

By calculating rolling averages and imputing missing trip data, the imputation algorithm enhanced the dataset's completeness and reliability, thereby facilitating more robust analyses of activity patterns and their associations with mental health outcomes. The resulting dataset with imputed trip data served as a valuable resource for exploring the relationship between daily activities and mental well-being.

[ADD HEAT MAP FIGURE OF ALL OF THE ACTIVITIES IN UTAH COUNTY]
[CREATE A HEAT MAP WITH EACH GEOJSON FILE UNDERNEATHER FOR EACH ACTIVITY LOCATION]

## Additional Parameters

The accuracy of the DBSCAN-TE algorithm in identifying activities was good, achieving 91% accurary. However, upon closer examination of some of the raw LBS data, instances appeared where activities seemed apparent but went undetected by the algorithm. These discrepancies prompted a deeper investigation into additional parameters that might shed light on the number of activities recorded.

To expand the analysis, we introduced calculations for the convex hull and total distance traveled. The convex hull, is the shape formed by connecting the outermost points of the LBS points in such a way that the resulting polygon is convex, meaning that any line segment connecting two poinr within the shapes lies entirely within the shape itself. By calculating the area enclosed by the convex hull, we gained a measure of the geographic footprint of the recorded activities. This value was reported in square meters.

@fig-areadistrib shows the distribution of the area covered for all of the userId-activityDays.

```{r figure area, message=FALSE, echo=FALSE}
#| label: fig-areadistrib
#| fig-cap: "Distribution of area covered for all userId-activityDays."

library(targets)
tar_load(area_distribution)
area_distribution
```

Additionally, we evaluated the total distance traveled by computing the length of the polyline, representing the trajectory of movement between consecutive LBS points during a participant's day. This value was reported in meters.

@fig-lengthdistrib shows the distribution of the distance travelled for all of ther userId-activityDays.

```{r figure length, message=FALSE, echo=FALSE}
#| label: fig-lengthdistrib
#| fig-cap: "Distribution of distance travelled for all userId-activityDays."

library(targets)
tar_load(length_distribution)
length_distribution
```

By incorporating these parameters alongside the number of identified activities, we aimed to further our understanding of the connection between the number of activities detected by the DBSCAN-TE algorithm and the geographic footprint of activities during the day and the total distance traveled in that same day.
